{% extends "base.html" %}

{% block title %}{{ job.title }} - JobMatch{% endblock %}

{% block content %}
<div class="mb-2">
    <a href="/jobs">&larr; Back to Jobs</a>
</div>

<div class="grid" style="grid-template-columns: 2fr 1fr; align-items: start;">
    <!-- Main Content -->
    <div>
        <div class="card">
            <div class="flex flex-between flex-center mb-2">
                <div>
                    <h1>{{ job.title }}</h1>
                    <div style="font-size: 1.1rem; color: #374151; margin-top: 0.25rem;">
                        {{ job.company.name if job.company else 'Unknown Company' }}
                    </div>
                </div>
                {% if job.is_featured %}
                    <span class="badge badge-yellow">Featured</span>
                {% endif %}
            </div>

            <div class="flex gap-2 mb-3" style="flex-wrap: wrap;">
                <span class="badge badge-gray">{{ job.location or 'Location not specified' }}</span>
                <span class="badge badge-gray">{{ job.job_type or 'Full-time' }}</span>
                <span class="badge badge-gray">{{ job.experience_level or 'Any level' }}</span>
                {% if job.is_remote %}
                    <span class="badge badge-blue">Remote</span>
                {% endif %}
            </div>

            {% if job.salary_min and job.salary_max and job.show_salary %}
                <div style="font-size: 1.25rem; color: #059669; font-weight: 600; margin-bottom: 1.5rem;">
                    ${{ "{:,}".format(job.salary_min) }} - ${{ "{:,}".format(job.salary_max) }} per year
                </div>
            {% endif %}

            <h2>Description</h2>
            <div style="white-space: pre-line; color: #4b5563;">{{ job.description }}</div>

            {% if job.requirements %}
                <h2 class="mt-3">Requirements</h2>
                <div style="white-space: pre-line; color: #4b5563;">{{ job.requirements }}</div>
            {% endif %}

            {% if job.responsibilities %}
                <h2 class="mt-3">Responsibilities</h2>
                <div style="white-space: pre-line; color: #4b5563;">{{ job.responsibilities }}</div>
            {% endif %}
        </div>

        <!-- Salary Prediction (from ML service) -->
        {% if salary_prediction %}
            <div class="card mt-2" style="border-left: 4px solid #059669;">
                <h3 style="color: #059669;">Salary Insight</h3>
                <p class="mt-1">
                    Estimated market salary: <strong>${{ "{:,}".format(salary_prediction.predicted_salary) }}</strong>
                </p>
                <p class="text-small text-muted">
                    Range: ${{ "{:,}".format(salary_prediction.confidence_interval[0]) }} - ${{ "{:,}".format(salary_prediction.confidence_interval[1]) }}
                    {% if salary_prediction.baseline %}
                        <span class="badge badge-gray">Baseline estimate</span>
                    {% endif %}
                </p>
            </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <div>
        <div class="card">
            {% if user and user.type == 'candidate' %}
                {% if already_applied %}
                    <div class="alert alert-info">
                        You have already applied to this job.
                    </div>
                    <a href="/candidate/dashboard" class="btn btn-secondary" style="width: 100%;">
                        View My Applications
                    </a>
                {% else %}
                    <a href="/jobs/{{ job.id }}/apply" class="btn btn-success" style="width: 100%;">
                        Apply Now
                    </a>
                {% endif %}
            {% elif user and user.type == 'company' %}
                <p class="text-muted text-center">You're logged in as a recruiter</p>
            {% else %}
                <a href="/auth/login" class="btn" style="width: 100%;">
                    Login to Apply
                </a>
                <p class="text-center text-small text-muted mt-1">
                    Don't have an account? <a href="/auth/register">Sign up</a>
                </p>
            {% endif %}

            <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e5e7eb;">

            <h4>About {{ job.company.name if job.company else 'the Company' }}</h4>
            {% if job.company %}
                <p class="text-small text-muted mt-1">
                    {{ job.company.description or 'No description available.' }}
                </p>
                <div class="mt-2 text-small">
                    {% if job.company.industry %}
                        <div><strong>Industry:</strong> {{ job.company.industry }}</div>
                    {% endif %}
                    {% if job.company.company_size %}
                        <div><strong>Size:</strong> {{ job.company.company_size }} employees</div>
                    {% endif %}
                    {% if job.company.headquarters %}
                        <div><strong>HQ:</strong> {{ job.company.headquarters }}</div>
                    {% endif %}
                </div>
            {% endif %}

            <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e5e7eb;">

            <div class="text-small text-muted">
                <div><strong>Posted:</strong> {{ job.posted_at.strftime('%B %d, %Y') if job.posted_at else 'Recently' }}</div>
                <div><strong>Job ID:</strong> {{ job.id }}</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
